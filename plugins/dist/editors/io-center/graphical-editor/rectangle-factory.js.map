{"version":3,"file":"rectangle-factory.js","sourceRoot":"","sources":["../../../../src/editors/io-center/graphical-editor/rectangle-factory.ts"],"names":[],"mappings":"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","sourcesContent":["import { RectangleOptions } from \"./rectangle.options\";\nimport { Connector } from \"../interfaces/connector.interface\";\nimport { Rectangle } from \"./rectangle\";\nimport {ConnectionManagerService} from \"../connection-manager/connection-manager.service\";\n\nexport class RectangleFactory {\n  private readonly shadowRoot: ShadowRoot;\n\n  private connectionManager = ConnectionManagerService.getInstance();\n\n  constructor(shadowRoot: ShadowRoot) {\n    this.shadowRoot = shadowRoot;\n  }\n\n  createRectangle(\n    options: RectangleOptions,\n    startConnection: (event: MouseEvent, type: \"input\" | \"output\") => void\n  ): Rectangle | undefined {\n    if (!this.shadowRoot) return undefined;\n\n    const rectangle = this.createBaseRectangle(options);\n    this.addHeaderToRectangle(rectangle, options);\n    this.addConnectors(rectangle, options, startConnection);\n    this.addActionBar(rectangle, options);\n\n    const gridContainer = this.shadowRoot.querySelector(\".grid-container\");\n    if (!gridContainer) return;\n\n    this.positionRectangle(rectangle, gridContainer, options);\n    gridContainer.appendChild(rectangle);\n\n    return new Rectangle(options.id, options, rectangle);\n  }\n\n  private createBaseRectangle(options: RectangleOptions): HTMLElement {\n    const rectangle = document.createElement(\"div\");\n    rectangle.id = options.id;\n    rectangle.classList.add(\"rectangle\");\n\n    // Adjusting the height by adding space for the action bar (e.g., 30px more)\n    const actionBarHeight = 30;\n    rectangle.style.width = `${options.width}px`;\n    rectangle.style.height = `${options.height + actionBarHeight}px`;\n\n    (rectangle as any).rectangleOptions = options;\n    return rectangle;\n  }\n\n  private addHeaderToRectangle(rectangle: HTMLElement, options: RectangleOptions) {\n    if (options.text) {\n      const headerElement = document.createElement(\"div\");\n      headerElement.classList.add(\"rectangle-header\");\n      headerElement.textContent = options.text;\n      rectangle.appendChild(headerElement);\n    }\n  }\n\n  private addConnectors(\n    rectangle: HTMLElement,\n    options: RectangleOptions,\n    startConnection: (event: MouseEvent, type: \"input\" | \"output\") => void\n  ) {\n    if (options.inputConnectors) {\n      options.inputConnectors.forEach((connector, index) => {\n        const inputConnector = this.createConnector('input-connector', connector, index, options.inputConnectors!.length);\n\n        inputConnector.addEventListener(\"click\", () => this.deleteConnection(connector.id));\n\n        inputConnector.addEventListener(\"mousedown\", (e) => {\n          e.stopPropagation();\n          startConnection(e, \"input\");\n        });\n        rectangle.appendChild(inputConnector);\n      });\n    }\n\n    if (options.outputConnectors) {\n      options.outputConnectors.forEach((connector, index) => {\n        const outputConnector = this.createConnector('output-connector', connector, index, options.outputConnectors!.length);\n\n        outputConnector.addEventListener(\"click\", () => this.deleteConnection(connector.id));\n\n        outputConnector.addEventListener(\"mousedown\", (e) => {\n          e.stopPropagation();\n          startConnection(e, \"output\");\n        });\n        rectangle.appendChild(outputConnector);\n      });\n    }\n  }\n\n\n  private deleteConnection(connectorId: string) {\n    const connection = this.connectionManager.findConnectionToOrFromConnector(connectorId);\n    if (connection) {\n      this.connectionManager.deleteConnectionObjectById(connection.id);\n    }\n  }\n\n  private createConnector(className: string, connector: Connector, index: number, total: number): HTMLElement {\n    const connectorElement = document.createElement(\"div\");\n    connectorElement.id = connector.id;\n    connectorElement.classList.add(\"connector\", className);\n\n    this.positionConnector(connectorElement, index, total, connector.position, connector.spacing || 0);\n\n    if (connector.text) {\n      const connectorText = document.createElement(\"div\");\n      connectorText.classList.add(\"connector-text\");\n      connectorText.textContent = connector.text;\n      connectorText.style.position = 'absolute';\n      connectorText.style.whiteSpace = 'nowrap';\n\n      connectorElement.appendChild(connectorText);\n\n      if (connector.position === 'left') {\n        connectorText.style.left = '20px';\n      } else if (connector.position === 'right') {\n        connectorText.style.right = '20px';\n      } else if (connector.position === 'top') {\n        connectorText.style.top = '20px';\n      } else if (connector.position === 'bottom') {\n        connectorText.style.bottom = '10px';\n      }\n    }\n\n    return connectorElement;\n  }\n\n  private positionConnector(\n    connector: HTMLElement,\n    index: number,\n    total: number,\n    position: 'left' | 'right' | 'top' | 'bottom',\n    spacing: number = 0\n  ) {\n    requestAnimationFrame(() => {\n      const parentRect = connector.parentElement!.getBoundingClientRect();\n\n      // Get the header and action bar heights\n      const header = connector.parentElement!.querySelector('.rectangle-header');\n      const actionBar = connector.parentElement!.querySelector('.action-bar');\n\n      const headerHeight = header ? header.getBoundingClientRect().height : 0;\n      const actionBarHeight = actionBar ? actionBar.getBoundingClientRect().height : 0;\n      const availableHeight = parentRect.height - headerHeight - actionBarHeight;\n\n      let connectorPosition: number;\n\n      if (total === 1) {\n        connectorPosition = position === 'left' || position === 'right'\n          ? (availableHeight - connector.offsetHeight) / 2 + headerHeight\n          : (parentRect.width - connector.offsetWidth) / 2;\n      } else {\n        const totalSpacing = spacing * (total - 1);\n        const availableSpace = (position === 'left' || position === 'right')\n          ? availableHeight - totalSpacing\n          : parentRect.width - totalSpacing;\n        const offset = availableSpace / total;\n        connectorPosition = index * (offset + spacing) + offset / 2 + headerHeight;\n      }\n\n      if (position === 'left') {\n        connector.style.left = '-5px';\n        connector.style.top = `${connectorPosition}px`;\n      } else if (position === 'right') {\n        connector.style.right = '-5px';\n        connector.style.top = `${connectorPosition}px`;\n      } else if (position === 'top') {\n        connector.style.top = '-5px';\n        connector.style.left = `${connectorPosition}px`;\n      } else if (position === 'bottom') {\n        connector.style.bottom = '-5px';\n        connector.style.left = `${connectorPosition}px`;\n      }\n    });\n  }\n\n  addActionBar(rectangle: HTMLElement, options: RectangleOptions) {\n    const actionBar = document.createElement(\"div\");\n    actionBar.classList.add(\"action-bar\");\n\n    if (options.onDelete) {\n      const deleteButton = document.createElement(\"button\");\n      deleteButton.innerHTML = '<mwc-icon class=\"icon-delete\">delete</mwc-icon>';\n\n      deleteButton.addEventListener(\"click\", (e) => {\n        e.stopPropagation();\n        if (options.onDelete) {\n          options.onDelete();\n        }\n      });\n\n      actionBar.appendChild(deleteButton);\n    }\n\n    if (options.onRouterAdd) {\n      const routerAddButton = document.createElement(\"button\");\n      routerAddButton.innerHTML = '<mwc-icon class=\"icon-custom\">add</mwc-icon>';\n\n      routerAddButton.addEventListener(\"click\", (e) => {\n        e.stopPropagation();\n        if (options.onRouterAdd) {\n          options.onRouterAdd();\n        }\n      });\n\n      actionBar.appendChild(routerAddButton);\n    }\n\n    if (options.onConnectorEdit) {\n      const connectorEditButton = document.createElement(\"button\");\n      connectorEditButton.innerHTML = '<mwc-icon class=\"icon-custom\">edit</mwc-icon>';\n\n      connectorEditButton.addEventListener(\"click\", (e) => {\n        e.stopPropagation();\n        if (options.onConnectorEdit) {\n          options.onConnectorEdit();\n        }\n      });\n\n      actionBar.appendChild(connectorEditButton);\n    }\n\n    rectangle.appendChild(actionBar);\n  }\n\n  private positionRectangle(rectangle: HTMLElement, container: Element, options: RectangleOptions) {\n    const margin = 10; // Margin between rectangles and from the edges\n    const containerRect = container.getBoundingClientRect();\n    const existingRectangles = Array.from(container.children) as HTMLElement[];\n\n    let x = margin;\n    let y = margin;\n\n    // Filter rectangles based on their intended position (left, middle, right)\n    const rectanglesInSamePosition = existingRectangles.filter(rect => {\n      const rectOptions = (rect as any).rectangleOptions as RectangleOptions;\n      return rectOptions && rectOptions.rectanglePosition === options.rectanglePosition;\n    });\n\n    // Determine y position based on the last rectangle in the same position group\n    if (rectanglesInSamePosition.length > 0) {\n      const lastRect = rectanglesInSamePosition[rectanglesInSamePosition.length - 1].getBoundingClientRect();\n      y = lastRect.bottom - containerRect.top + margin;\n    }\n\n    // Determine x position based on rectanglePosition\n    switch (options.rectanglePosition) {\n      case 'left':\n        x = margin;\n        break;\n      case 'middle':\n        x = (containerRect.width / 2) - (options.width / 2);\n        break;\n      case 'right':\n        x = containerRect.width - options.width - margin;\n        break;\n    }\n\n    // Ensure the rectangle is positioned absolutely within the container\n    rectangle.style.position = 'absolute';\n    rectangle.style.left = `${x}px`;\n    rectangle.style.top = `${y}px`;\n  }\n}\n"]}