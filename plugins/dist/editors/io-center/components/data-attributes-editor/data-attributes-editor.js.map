{"version":3,"file":"data-attributes-editor.js","sourceRoot":"","sources":["../../../../../src/editors/io-center/components/data-attributes-editor/data-attributes-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, customElement, html, LitElement, property } from \"lit-element\";\nimport { FormGroup } from \"../forms/form-group\";\n\nimport '../forms/check-box';\nimport '../forms/number-input';\nimport '../forms/text-input';\nimport '../forms/selection-box';\nimport '../forms/form-group';\nimport '../hint-box/hint-box';\n\n@customElement(\"data-attributes-editor\")\nexport class DataAttributesEditor extends LitElement {\n  static styles = css`\n    :host {\n      display: block;\n    }\n\n    .search-input {\n      margin-top: 1rem;\n    }\n\n    .save-button {\n      margin-top: 1rem;\n      padding: 0.5rem 1rem;\n      background-color: #007bff;\n      color: white;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n    }\n\n    .save-button:hover {\n      background-color: #0056b3;\n    }\n\n    .filter-modified {\n      margin: 1rem 0;\n      display: flex;\n      align-items: center;\n    }\n  `;\n\n  @property({ type: XMLDocument }) doc: XMLDocument | undefined = undefined;\n  @property({ type: String }) lnClass: string = '';\n  @property({ type: Object }) formGroup!: FormGroup;\n  @property({ type: Array }) filteredDataObjects: Array<any> = [];\n  @property({ type: Boolean }) showOnlyModified: boolean = false;\n\n  private attributeValues: { [dataObjectName: string]: { [attributeName: string]: any } } = {};\n\n  resetAttributeValues() {\n    this.attributeValues = {};\n  }\n\n  clearComponent() {\n    this.resetAttributeValues();\n    this.formGroup.resetFormGroup();\n    this.requestUpdate();\n  }\n\n  private getLnClass() {\n    return this.doc?.querySelectorAll(`LNodeType[lnClass=\"${this.lnClass}\"]`);\n  }\n\n  private getLnNodeType() {\n    const lnClass = this.getLnClass();\n    if (lnClass && lnClass.length > 0) {\n      const lnodeType = lnClass[0];\n      return lnodeType.querySelectorAll('DO');\n    }\n    return null;\n  }\n\n  private getDataObjects() {\n    const doElements = this.getLnNodeType();\n    if (doElements) {\n      return Array.from(doElements).map(doElement => {\n        const doTypeId = doElement.getAttribute('type');\n        const doType = this.doc?.querySelector(`DOType[id=\"${doTypeId}\"]`);\n        const daElements = doType?.querySelectorAll('DA');\n\n        return {\n          name: doElement.getAttribute('name'),\n          dataAttributes: Array.from(daElements || []).map(da => ({\n            name: da.getAttribute('name'),\n            fc: da.getAttribute('fc'),\n            bType: da.getAttribute('bType'),\n            values: Array.from(da.querySelectorAll('Val') || []).map(val => val.textContent)\n          }))\n        };\n      });\n    }\n    return [];\n  }\n\n  private handleInputChange(dataObjectName: string, attributeName: string, value: any) {\n    if (!this.attributeValues[dataObjectName]) {\n      this.attributeValues[dataObjectName] = {};\n    }\n\n    if (value === '' || value === null || value === undefined) {\n      delete this.attributeValues[dataObjectName][attributeName];\n    } else {\n      this.attributeValues[dataObjectName][attributeName] = value;\n    }\n\n    if (Object.keys(this.attributeValues[dataObjectName]).length === 0) {\n      delete this.attributeValues[dataObjectName];\n    }\n\n    const hintBox = this.shadowRoot?.querySelector(`hint-box[data-object-name=\"${dataObjectName}\"]`);\n    if (hintBox) {\n      (hintBox as any).isMarked = Object.keys(this.attributeValues[dataObjectName] || {}).length > 0;\n    }\n\n    this._dispatchData();\n    this.requestUpdate();\n  }\n\n  private renderInputField(dataObjectName: string, attributeName: string | null, bType: string | null) {\n    if (!attributeName || !bType) {\n      return html`<span>No data attribute provided</span>`;\n    }\n\n    const onInputChange = (e: any) => this.handleInputChange(dataObjectName, attributeName, e.target.value);\n\n    switch (bType.toUpperCase()) { // Ensure bType is case insensitive\n      case 'BOOLEAN':\n        return html`\n        <checkbox-input\n          name=\"${attributeName}\"\n          label=\"${attributeName} (type: ${bType})\"\n          .checked=${this.attributeValues[dataObjectName]?.[attributeName] || false}\n          @input=\"${(e: any) => onInputChange(!!e.target.checked)}\">\n        </checkbox-input>\n      `;\n      case 'INT':\n      case 'INT32':\n      case 'FLOAT':\n      case 'FLOAT32':\n        return html`\n        <number-input\n          name=\"${attributeName}\"\n          label=\"${attributeName} (type: ${bType})\"\n          .value=\"${this.attributeValues[dataObjectName]?.[attributeName] || ''}\"\n          @input=\"${onInputChange}\">\n        </number-input>\n      `;\n      case 'STRING':\n      case 'VISSTRING255':\n      case 'ENUM':\n      case 'QUALITY':\n      case 'TIMESTAMP':\n        return html`\n        <text-input\n          name=\"${attributeName}\"\n          label=\"${attributeName} (type: ${bType})\"\n          .value=\"${this.attributeValues[dataObjectName]?.[attributeName] || ''}\"\n          @input=\"${onInputChange}\">\n        </text-input>\n      `;\n      default:\n        return html`\n        <text-input\n          name=\"${attributeName}\"\n          label=\"${attributeName} (type: ${bType})\"\n          .value=\"${this.attributeValues[dataObjectName]?.[attributeName] || ''}\"\n          @input=\"${onInputChange}\">\n        </text-input>\n      `;\n    }\n  }\n\n  private renderNoLogicalNode() {\n    return html`\n      <span>No logical node selected. Please select a logical node to view its data attributes.</span>\n    `;\n  }\n\n  private renderUndefinedXmlDoc() {\n    return html`\n      <span>No XML Document provided. Please provide a valid XML document to view data attributes.</span>\n    `;\n  }\n\n  private _onSearchChange(event: CustomEvent) {\n    const searchValue = event.detail.toLowerCase();\n    const allDataObjects = this.getDataObjects();\n\n    this.filteredDataObjects = allDataObjects.filter(doObj =>\n      doObj.name?.toLowerCase().includes(searchValue) ||\n      doObj.dataAttributes.some(da =>\n        da.name?.toLowerCase().includes(searchValue) ||\n        da.fc?.toLowerCase().includes(searchValue) ||\n        da.bType?.toLowerCase().includes(searchValue)\n      )\n    );\n  }\n\n  private _onFilterChange(event: CustomEvent) {\n    this.showOnlyModified = event.detail;\n    this.requestUpdate();\n  }\n\n  private _dispatchData() {\n    this.dispatchEvent(new CustomEvent('data-changed', {\n      detail: this.attributeValues,\n      bubbles: true,\n      composed: true,\n    }));\n  }\n\n  render() {\n    if (!this.lnClass) {\n      return this.renderNoLogicalNode();\n    }\n\n    if (!this.doc) {\n      return this.renderUndefinedXmlDoc();\n    }\n\n    const allDataObjects = this.getDataObjects();\n    const dataObjects = this.filteredDataObjects.length > 0 ? this.filteredDataObjects : allDataObjects;\n\n    const displayedDataObjects = this.showOnlyModified\n      ? dataObjects.filter(doObj => Object.keys(this.attributeValues[doObj.name] || {}).length > 0)\n      : dataObjects;\n\n    if (displayedDataObjects.length === 0 && !this.showOnlyModified) {\n      return html`<span>No data objects found</span>`;\n    }\n\n    return html`\n      <div class=\"search-input\">\n        <text-input\n          label=\"Search\"\n          @value-changed=\"${this._onSearchChange}\"\n          placeholder=\"Search data objects (DO)\">\n        </text-input>\n      </div>\n\n      <div class=\"filter-modified\">\n        <check-box\n          label=\"Show only modified\"\n          @value-changed=\"${this._onFilterChange}\"\n        ></check-box>\n      </div>\n\n      <div class=\"data-object-content\">\n        <div class=\"data-object-header\">\n          <h4>Data Objects</h4>\n        </div>\n        <div class=\"data-object-list\">\n          ${displayedDataObjects.map(doObj => {\n            const isMarked = !!Object.keys(this.attributeValues[doObj.name] || {}).length;\n            return html`\n          <hint-box title=\"${doObj.name}\" .isMarked=\"${isMarked}\" data-object-name=\"${doObj.name}\">\n            ${doObj.dataAttributes.map((da: any) => html`\n              <div>\n                <h4>${da.name} (type: ${da.bType})</h4>\n                <ul>\n                  ${da.values.map((value: any) => html`<li>${value}</li>`)}\n                </ul>\n                ${this.renderInputField(doObj.name, da.name, da.bType)}\n              </div>\n            `)}\n          </hint-box>\n        `;\n          })}\n        </div>\n      </div>\n\n    `;\n  }\n}\n"]}