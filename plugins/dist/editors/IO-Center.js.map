{"version":3,"file":"IO-Center.js","sourceRoot":"","sources":["../../src/editors/IO-Center.ts"],"names":[],"mappings":"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","sourcesContent":["import {css, html, LitElement, property, PropertyValues, query, state, TemplateResult} from \"lit-element\";\nimport {Nsdoc} from '@openscd/open-scd/src/foundation/nsdoc.js';\nimport {get} from \"lit-translate\";\nimport {compareNames, getDescriptionAttribute, getNameAttribute,} from '@openscd/open-scd/src/foundation.js';\nimport {SelectedItemsChangedEvent} from '@openscd/open-scd/src/oscd-filter-button.js';\n\n\nimport './io-center/io-center-container.js';\nimport {nothing} from \"lit-html\";\nimport {IIED} from \"./io-center/interfaces/ied.interface\";\nimport {IoCenterContainer} from \"./io-center/io-center-container\";\nimport {ILogicalDevice} from \"./io-center/interfaces/logical-device.interface\";\n\n/** An editor [[`plugin`]] for editing the `IO Center Plugin` section. */\nexport default class IoCenterPlugin extends LitElement {\n  /** The document being edited as provided to plugins by [[`OpenSCD`]]. */\n  @property()\n  doc!: XMLDocument;\n\n  @property({type: Number})\n  editCount = -1;\n\n  /** All the nsdoc files that are being uploaded via the settings. */\n  @property()\n  nsdoc!: Nsdoc;\n\n  @query('io-center-container')\n  ioCenterContainer!: IoCenterContainer;\n\n  @state()\n  selectedIEDs: string[] = [];\n\n  @state()\n  selectedLNClasses: string[] = [];\n\n  @state()\n  logicalDevices: ILogicalDevice[] = [];\n\n  @state()\n  private get iedList(): Element[] {\n    return this.doc\n      ? Array.from(this.doc.querySelectorAll(':root > IED')).sort((a, b) =>\n        compareNames(a, b)\n      )\n      : [];\n  }\n\n  @state()\n  currentIed?: IIED = undefined;\n\n  @state()\n  private get selectedIed(): Element | undefined {\n    if (this.selectedIEDs.length > 0) {\n      const iedList = this.iedList;\n      return iedList.find(element => {\n        const iedName = getNameAttribute(element);\n        return this.selectedIEDs[0] === iedName;\n      });\n    }\n\n    return undefined;\n  }\n\n  @state()\n  private get lnClassList(): string[][] {\n    const currentIed = this.selectedIed;\n    const uniqueLNClassList: string[] = [];\n    if (currentIed) {\n      return Array.from(currentIed.querySelectorAll('LN0, LN'))\n        .filter(element => element.hasAttribute('lnClass'))\n        .filter(element => {\n          const lnClass = element.getAttribute('lnClass') ?? '';\n          if (uniqueLNClassList.includes(lnClass)) {\n            return false;\n          }\n          uniqueLNClassList.push(lnClass);\n          return true;\n        })\n        .sort((a, b) => {\n          const aLnClass = a.getAttribute('lnClass') ?? '';\n          const bLnClass = b.getAttribute('lnClass') ?? '';\n\n          return aLnClass.localeCompare(bLnClass);\n        })\n        .map(element => {\n          const lnClass = element.getAttribute('lnClass');\n          const label = this.nsdoc.getDataDescription(element).label;\n          return [lnClass, label];\n        }) as string[][];\n    }\n    return [];\n  }\n\n  protected updated(_changedProperties: PropertyValues): void {\n    super.updated(_changedProperties);\n\n    // When the document is updated, we reset the selected IED if it no longer exists\n    const isDocumentUpdated =\n      _changedProperties.has('doc') ||\n      _changedProperties.has('editCount') ||\n      _changedProperties.has('nsdoc');\n\n    if (isDocumentUpdated) {\n      // if the IED exists, retain selection\n      const iedExists = this.doc?.querySelector(\n        `IED[name=\"${this.selectedIEDs[0]}\"]`\n      );\n\n      if (iedExists) return;\n\n      this.selectedIEDs = [];\n      this.selectedLNClasses = [];\n      this.lNClassListOpenedOnce = false;\n\n      const iedList = this.iedList;\n      if (iedList.length > 0) {\n        const iedName = getNameAttribute(iedList[0]);\n        if (iedName) {\n          this.selectedIEDs = [iedName];\n        }\n      }\n    }\n  }\n\n  private calcSelectedLNClasses(): string[] {\n    const somethingSelected = this.selectedLNClasses.length > 0;\n    const lnClasses = this.lnClassList.map(lnClassInfo => lnClassInfo[0]);\n\n    let selectedLNClasses = lnClasses;\n\n    if (somethingSelected) {\n      selectedLNClasses = lnClasses.filter(lnClass =>\n        this.selectedLNClasses.includes(lnClass)\n      );\n    }\n\n    return selectedLNClasses;\n  }\n\n  lNClassListOpenedOnce = false;\n\n  render(): TemplateResult {\n    const iedList = this.iedList;\n\n    if (iedList.length > 0) {\n      const iedName = this.selectedIEDs[0];\n      if (!iedName) {\n        return html`<h1>\n          <span style=\"color: var(--base1)\">${get('didoeditor.missing')}</span>\n        </h1>`;\n      }\n\n      return html`\n        <section class=\"io-center-main-container\">\n          <div class=\"header\">\n              <h1>${get('filters')}:</h1>\n              <oscd-filter-button\n                id=\"iedFilter\"\n                icon=\"developer_board\"\n                .header=${get('iededitor.iedSelector')}\n                @selected-items-changed=\"${(e: SelectedItemsChangedEvent) => {\n                  const equalArrays = <T>(first: T[], second: T[]): boolean => {\n                    return (\n                      first.length === second.length &&\n                      first.every((val, index) => val === second[index])\n                    );\n                  };\n\n                  const selectionChanged = !equalArrays(\n                    this.selectedIEDs,\n                    e.detail.selectedItems\n                  );\n\n                  if (!selectionChanged) {\n                    return;\n                  }\n\n                  this.lNClassListOpenedOnce = false;\n                  this.selectedIEDs = e.detail.selectedItems;\n                  this.selectedLNClasses = [];\n                  this.requestUpdate('selectedIed');\n                }}\"\n              >\n                ${iedList.map(ied => {\n                  const name = getNameAttribute(ied);\n                  const descr = getDescriptionAttribute(ied);\n                  const type = ied.getAttribute('type');\n                  const manufacturer = ied.getAttribute('manufacturer');\n                  return html`\n                  <mwc-radio-list-item\n                    value=\"${name}\"\n                    ?twoline=\"${type && manufacturer}\"\n                    ?selected=\"${this.selectedIEDs.includes(name ?? '')}\"\n                  >\n                    ${name} ${descr ? html` (${descr})` : html``}\n                    <span slot=\"secondary\">\n                  ${type} ${type && manufacturer ? html`&mdash;` : nothing}\n                  ${manufacturer}\n                </span>\n                  </mwc-radio-list-item>`;\n                })}\n              </oscd-filter-button>\n          </div>\n\n          <io-center-container\n            .currentIed=${iedName}\n            .editCount=${this.editCount}\n            .doc=${this.doc}\n            .element=${this.selectedIed}\n            .selectedLNClasses=${this.calcSelectedLNClasses()}\n            .nsdoc=${this.nsdoc}\n          ></io-center-container>\n        </section>\n      `\n    }\n    return html`<h1>\n      <span style=\"color: var(--base1)\">${get('didoeditor.missing')}</span>\n    </h1>`;\n  }\n\n  static styles = css`\n    :host {\n      width: 100vw;\n      height: 100vh;\n    }\n\n    .io-center-main-container {\n      height: calc(100vh - 190px);\n      width: auto;\n      padding: 8px 12px 16px;\n    }\n\n    .header {\n      display: flex;\n    }\n\n    h1 {\n      color: var(--mdc-theme-on-surface);\n      font-family: 'Roboto', sans-serif;\n      font-weight: 300;\n      overflow: hidden;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n      margin: 0px;\n      line-height: 48px;\n      padding-left: 0.3em;\n    }\n\n    .elementPath {\n      margin-left: auto;\n      padding-right: 12px;\n    }\n  `;\n}\n"]}